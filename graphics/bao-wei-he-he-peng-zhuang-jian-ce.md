---
description: >-
  https://stackoverflow.com/questions/99796/when-to-use-binary-space-partitioning-quadtree-octree
---

# 包围盒和碰撞检测

目前对于任意复杂三角形集合（mesh）的碰撞检测多数基于BVTree（bounding volume tree）,具体可以是aabb tree，obb tree或者K-dop tree等。在使用包围盒树进行碰撞检测的时候，如果父节点没有相交则可以停止，如果相交则有可能碰撞，递归的处理子节点直到叶子结点。

## AABB（轴对齐包围盒）

**特点**：总是平行于坐标轴的包围盒。最方便快捷，常用。

**构造**：

![](../.gitbook/assets/image%20%285%29.png)

**碰撞检测方法**：直接将两个AABB包围盒投影到三个坐标轴，查看投影是否有交集。

```text
step-1: 把A加入到树结构中,作为根节点
step-2: 把B加入到数结构中,这时需要和根节点做比较,判断根节点的区域是否跟B有交集,如果有的话
        就判断子节点是否跟B有交集,如果都没有就判断B分别加入子节点区域后的面积,找到面节差最
        小的,组合。如果B与根节点没有交集,就把A和B当作一个整体重新构建轮廓(橘黄色的矩形),并
        生成A,B的父节点(上图中橘黄色的圆圈),
step-3: 把C加入到树中,判断是否有交集,方法与step-2中一样,最终得到上图中的树

最终所有的物体将会在树的叶节点上。
树中除叶节点外,所有的节点存的都是自己的面积,或是说是自己的轮廓矩形的四个点的坐标。
```

## OBB（有向包围盒）

**特点**：无需和坐标轴平行，可以选择最紧凑的盒子，精度高，更小，计算代价大，不太适合动态柔性物体

**构造**：

**碰撞检测方法:**

两个凸多边形物体，如果我们能找到一个轴，使得两个在物体在该轴上的投影互不重叠，则这两个物体之间没有碰撞发生，该轴为分离轴Separating Axis。一般以垂直于多边形每条边的垂线作为轴。

![](../.gitbook/assets/image%20%2820%29.png)

![](../.gitbook/assets/image%20%2830%29.png)

将每个矩形的四个顶点投影投影到轴上，并计算四个顶点间最长的连线距离，判断两个矩形的投影距离是否有重叠。

## BSP（二叉空间分割树）

特点:适用于内容紧凑的室内场景和光线跟踪。适合排序，构建慢，但划分更加均匀，通常用于静态场景。它将多边形分解成一个结构，可以从任意相机位置完美的呈现部分物体和遮挡关系

## octree\(八叉树\)

**特点**：适用于室外大场景，构建方便

