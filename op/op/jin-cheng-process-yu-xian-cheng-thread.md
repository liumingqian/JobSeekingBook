# 进程（process）与线程（thread）

### 概念

* 进程：操作系统种拥有资源和独立调度的基本单位（通常一个程序对应一个进程）
* 线程：实现进程内部的并发，同一进程中的线程切换不会引起进程切换，线程切换开销小很多。
  * 用户级线程： 由应用程序管理。应用程序启动后，操作系统给该程序分配一个进程号和内存空间等资源，程序运行在主线程。
  * 内核级线程： 有关线程管理的工作由内核完成，应用程序没有代码，只能调用内核线程的接口。调度也由内核基于线程架构完成。内核可以将不同线程更好的分配到不同cpu，实现并行计算。
  * 组合方式实现多线程： 线程创建在用户空间，但多个用户级线程被映射到内核级线程上
* [ ] 内核是啥   

### **进线程通信**

进程拥有自己的地址空间，进程内的线程对于其他进程不可见，同一进程的线程间可以通过_传递地址或全局变量_的方式传递信息。

进程间通信的几种方式

1. 共享内存： 不同进程读写操作系统中特殊的共享内存进行数据交换，用semaphore实现同步
2. 类似网络通信：在操作系统内部注册一个端口，并监测是否有数据，其他进程直接写数据到该端口。网络通信其实也是一种进程分布在不同机器上的IPC。

#### **进程和线程的堆栈内存管理**

线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源\(如程序计数器,一组寄存器和栈\)，多个线程共享进程的内存资源。

堆：是大家共有的空间，分全局堆和局部堆。全局堆就是所有没有分配的空间，局部堆就是用户分配的空间。堆在操作系统对进程初始化的时候分配，运行过程中也可以向系统要额外的堆，但是记得用完了要还给操作系统，要不然就是内存泄漏。

栈：是个线程独有的，保存其运行状态和局部自动变量的。栈在线程开始的时候初始化，每个线程的栈互相独立，因此，栈是thread safe的。

#### 互斥锁（mutex）和信号量（semaphore）

* mutex:防止多个线程同时读取一块内存区域用的。是semaphore的一种特殊情况。
* semaphore:保证多个线程不会相互冲突用的。某些内存区域只能供给固定数目的线程使用。在门口挂n把钥匙，进去的人就取一把，出来时再挂回原处。后来的人拿不到钥匙就只能在门口等待。

### 上下文切换

对于单核单线程的CPU，同一时刻只能执行一条CPU指令，上下文切换是将CPU资源从一个进程分配给另一个进程的机制，使计算机从用户角度看来可以并行运行多个进程。

> 切换时发生了什么？
>
> 操作系统需要先存储当前进程的状态，包括内存空间指针，当前执行完的指令等，然后读入下一个进程的状态，执行此进程

### 

